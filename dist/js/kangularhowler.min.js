"use strict";angular.module("kAngularHowlerApp",[]),angular.module("kAngularHowlerApp").controller("AudioCtrl",["$document","$scope","$timeout","$interval",function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=this;n.data={startIcon:"fa fa-play",stopIcon:"stop",pauseIcon:"fa fa-pause",volumeUp:"fa fa-volume-up",volumeDown:"fa fa-volume-down",volumeOff:"fa fa-volume-off"},l=function(){d.cancel(k),m&&Howler.unload()},i=function(a){return a>.5?n.data.volumeUp:.5>=a&&a>0?n.data.volumeDown:n.data.volumeOff},e=function(){f=!1,n.playIcon=n.data.startIcon,d.cancel(k)},g={play:function(a,c){var g,h;return a="number"==typeof a?a:0,0>a||!c||0===c.length||a>=c.length?void 0:(h=c[a],h.howl?g=h.howl:(g=h.howl=new Howl({src:h.src,volume:n.volume,html5:!0,onplay:function(a){n.duration=h.howl.duration(),f=!0,n.playIcon=n.data.pauseIcon,n.showSoundInfo=!0,n.showSpinner=!1,n.showError=!1,k=d(j,500)},onload:function(){m.loaded=!0},onloaderror:function(a){n.showError=!0,n.showSpinner=!1,b.$apply()},onend:function(){e(),b.$apply()},onpause:function(){e(),b.$apply()},onstop:function(){b.$apply()},onseek:function(){d.cancel(k),k=d(j,500)}}),m=g),n.image=h.image,n.username=h.username,n.filename=h.filename,n.userId=h.userId,n.userProfileLink=h.userProfileLink,g.play())},pause:function(a,b,c){c[a]&&c[a].howl&&c[a].howl.pause(b)},stop:function(a,b,c){try{c&&c[a].howl&&c[a].howl.stop(b)}catch(d){}},volumeChange:function(a,b,c){c[a]&&c[a].howl&&(c[a].howl.volume(b),n.volumeIcon=i(b))},seek:function(a,b,c,d){return c[a]&&c[a].howl?d?c[a].howl.seek(d,b):c[a].howl.seek(b):void 0}},h=function(){b.playlist&&b.playlist.length>0&&(l(),n.triggerElm=b.triggerElm,f=!1,n.volume=b.volume||.4,n.playbackPosition=0,n.duration=0,n.startOffset=0,n.showSoundInfo=!1,n.showSpinner=!1,n.showError=!1,n.showVolumeLevel=!1,n.thisIsVolumeRange=!1,n.volumeIcon=i(n.volume),n.volumeLevel=30,n.playIcon=n.data.startIcon,n.playlist=b.playlist,n.autoPlay="boolean"==typeof b.autoPlay?b.autoPlay:!1,n.hideAtStateChange="boolean"==typeof b.hideAtStateChange?b.hideAtStateChange:!0,b.index&&b.index>0&&b.index<n.playlist.length?n.index=b.index:n.index=0,n.playlist=b.playlist,n.autoPlay&&n.play())},j=function(){n.startOffset=g.seek(n.index,n.soundId,n.playlist)||0,n.playbackPosition=100*n.startOffset/n.duration},n.volumeChange=function(){g.volumeChange(n.index,n.volumeLevel/100,n.playlist)},n.timeChange=function(){try{d.cancel(k),n.startOffset=n.playbackPosition*n.duration/100,g.seek(n.index,n.soundId,n.playlist,n.startOffset)}catch(a){}},n.play=function(){f?g.pause(n.index,n.soundId,n.playlist):(n.showSpinner=!0,n.showError=!1,n.soundId=g.play(n.index,n.playlist))},n.move=function(a){var b="backward"===a?n.index-1:n.index+1;b>n.playlist.length-1&&(b=0),0>b&&(b=n.playlist.length-1),n.showSoundInfo=!1,g.stop(n.index,n.soundId,n.playlist),f=!1,n.index=b,n.play()},n.hideVolume=function(){n.showVolumeLevel=!1,n.thisIsVolumeRange=!1},n.showVolume=function(){n.thisIsVolumeRange||(n.showVolumeLevel=!n.showVolumeLevel),n.thisIsVolumeRange=!1},n.close=function(){l(),b.playlist=null},h()}]),angular.module("kAngularHowlerApp").directive("sonicAudio",[function(){return{templateUrl:"views/audio.html",controller:"AudioCtrl as audioCtrl",restrict:"E",replace:!0,scope:{playlist:"=?",autoPlay:"=?",hideAtStateChange:"=?",index:"=?",triggerElm:"@"},link:function(a,b,c){}}}]),angular.module("kAngularHowlerApp").filter("secondsToDateTime",[function(){return function(a){return new Date(1970,0,1).setSeconds(a)}}]),angular.module("kAngularHowlerApp").run(["$templateCache",function(a){a.put("views/audio.html",'<div class="sonic-audio-player-wrapper" ng-show="playlist"> <div class="sonic-audio-player-base"></div> <div class="sonic-audio-player"> <div class="sap-section"> <i class="sap-icon fa fa-step-backward" ng-if="playlist.length > 1" ng-click="audioCtrl.move(\'backward\')"></i> <span class="sap-icon" ng-click="audioCtrl.play()"> <i ng-if="audioCtrl.showSpinner" class="fa fa-circle-o-notch fa-spin sap-spinner-icon"></i> <span class="sap-icon-play"> <i class="{{audioCtrl.playIcon}}" ng-if="!audioCtrl.showSpinner"></i> </span> </span> <i class="sap-icon fa fa-step-forward" ng-if="playlist.length > 1" ng-click="audioCtrl.move()"></i> <span class="sap-icon spn-icon-volume {{audioCtrl.volumeIcon}}" ng-click="audioCtrl.showVolume(this)" ng-mouseleave="audioCtrl.showVolumeLevel = false" asc-click-anywhere-but-here="audioCtrl.hideVolume()" stop-event="click"> <input class="volume-level" type="range" class="level" ng-if="audioCtrl.showVolumeLevel" ng-click="audioCtrl.thisIsVolumeRange = true;" ng-change="audioCtrl.volumeChange()" ng-model="audioCtrl.volumeLevel"> </span> <span ng-show="audioCtrl.showSoundInfo" ui-sref="profile.wall({id:\'{{audioCtrl.userId}}\'})" class="sap-icon user-img-background sap-image"> <img class="sap-info-image" src="{{audioCtrl.image}}"> </span> <span class="sap-info"> <span class="sap-name" ng-show="audioCtrl.showSoundInfo"> <span class="sap-info-user-name"> <a ng-href="{{audioCtrl.userProfileLink}}"> {{audioCtrl.username}} </a> </span> <span class="sap-info-file-name"> {{audioCtrl.filename}} </span> </span> </span> <span class="progressbar"> <span ng-show="audioCtrl.startOffset" class="sonic-audio-player-meter sonic-audio-player-meter-left"> {{ audioCtrl.startOffset | secondsToDateTime | date:\'mm:ss\'}}</span> <input class="progressbar-input" id="progressBar" type="range" ng-change="audioCtrl.timeChange()" ng-model="audioCtrl.playbackPosition"> <span class="sonic-audio-player-meter sonic-audio-player-meter-right"> {{ audioCtrl.duration | secondsToDateTime | date:\'mm:ss\'}}</span> </span> <span class="sap-error" ng-show="audioCtrl.showError"> The file format is not supported. </span> <i class="sap-icon-close fa fa-times" ng-click="audioCtrl.close()"></i> </div> </div> </div>')}]);